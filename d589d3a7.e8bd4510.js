(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{80:function(e,n,r){"use strict";r.r(n),r.d(n,"frontMatter",(function(){return l})),r.d(n,"metadata",(function(){return i})),r.d(n,"toc",(function(){return o})),r.d(n,"default",(function(){return s}));var a=r(3),t=r(7),c=(r(0),r(86)),l={id:"getting-started",title:"Getting started"},i={unversionedId:"getting-started",id:"getting-started",isDocsHomePage:!1,title:"Getting started",description:"Getting started",source:"@site/docs/getting-started.md",slug:"/getting-started",permalink:"/hlf-operator/docs/getting-started",editUrl:"https://github.com/kfsoftware/hlf-operator/edit/master/website/docs/getting-started.md",version:"current",sidebar:"someSidebar",previous:{title:"Introduction",permalink:"/hlf-operator/docs/"},next:{title:"Certificate Authority",permalink:"/hlf-operator/docs/ca"}},o=[{value:"Getting started",id:"getting-started",children:[{value:"Requirements",id:"requirements",children:[]},{value:"Install Istio",id:"install-istio",children:[]},{value:"Installing the operator",id:"installing-the-operator",children:[]},{value:"Installing the Kubectl HLF Plugin",id:"installing-the-kubectl-hlf-plugin",children:[]}]},{value:"Deploy a Peer Organization",id:"deploy-a-peer-organization",children:[{value:"Deploying a Certificate Authority",id:"deploying-a-certificate-authority",children:[]},{value:"Deploying a peer",id:"deploying-a-peer",children:[]}]},{value:"Deploying an Ordering Service",id:"deploying-an-ordering-service",children:[{value:"Deploying a certificate authority",id:"deploying-a-certificate-authority-1",children:[]},{value:"Deploying the Ordering service",id:"deploying-the-ordering-service",children:[]}]},{value:"Preparing a connection string for the ordering service",id:"preparing-a-connection-string-for-the-ordering-service",children:[]},{value:"Create a consortium",id:"create-a-consortium",children:[]},{value:"Preparing a connection string for the peer",id:"preparing-a-connection-string-for-the-peer",children:[]},{value:"Create a channel",id:"create-a-channel",children:[]},{value:"Add anchor peer",id:"add-anchor-peer",children:[]},{value:"Join channel",id:"join-channel",children:[]},{value:"See ledger height",id:"see-ledger-height",children:[]},{value:"Install a chaincode",id:"install-a-chaincode",children:[]},{value:"Query chaincodes installed",id:"query-chaincodes-installed",children:[]},{value:"Approve chaincode",id:"approve-chaincode",children:[]},{value:"Commit chaincode",id:"commit-chaincode",children:[]},{value:"Invoke a transaction in the ledger",id:"invoke-a-transaction-in-the-ledger",children:[]},{value:"Query the ledger",id:"query-the-ledger",children:[{value:"Cleanup the environment",id:"cleanup-the-environment",children:[]}]}],d={toc:o};function s(e){var n=e.components,r=Object(t.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},d,r,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"getting-started"},"Getting started"),Object(c.b)("h3",{id:"requirements"},"Requirements"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Fabric CA client"),Object(c.b)("li",{parentName:"ul"},"YQ binary to replace values in YAML (for the getting started)"),Object(c.b)("li",{parentName:"ul"},"KubeCTL"),Object(c.b)("li",{parentName:"ul"},"Kubernetes 1.15+"),Object(c.b)("li",{parentName:"ul"},"Istio")),Object(c.b)("h3",{id:"install-istio"},"Install Istio"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl apply -f ./hack/istio-operator/crds/*\nhelm template ./hack/istio-operator/ \\\n  --set hub=docker.io/istio \\\n  --set tag=1.8.0 \\\n  --set operatorNamespace=istio-operator \\\n  --set watchedNamespaces=istio-system | kubectl apply -f -\n\nkubectl create ns istio-system\nkubectl apply -n istio-system -f ./hack/istio-operator.yaml\n")),Object(c.b)("h3",{id:"installing-the-operator"},"Installing the operator"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"helm install hlf-operator ./chart/hlf-operator\n")),Object(c.b)("h3",{id:"installing-the-kubectl-hlf-plugin"},"Installing the Kubectl HLF Plugin"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl krew install hlf \n")),Object(c.b)("h2",{id:"deploy-a-peer-organization"},"Deploy a Peer Organization"),Object(c.b)("h3",{id:"deploying-a-certificate-authority"},"Deploying a Certificate Authority"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf ca create --storage-class=standard --capacity=2Gi --name=org1-ca \\\n    --enroll-id=enroll --enroll-pw=enrollpw  \nkubectl wait --timeout=180s --for=condition=Running fabriccas.hlf.kungfusoftware.es --all\n\n# register user for the peers\nkubectl hlf ca register --name=org1-ca --user=peer --secret=peerpw --type=peer \\\n --enroll-id enroll --enroll-secret=enrollpw --mspid Org1MSP\n")),Object(c.b)("h3",{id:"deploying-a-peer"},"Deploying a peer"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"\nkubectl hlf peer create --storage-class=standard --enroll-id=peer --mspid=Org1MSP \\\n       --enroll-pw=peerpw --capacity=5Gi --name=org1-peer0 --ca-name=org1-ca.default\nkubectl wait --timeout=180s --for=condition=Running fabricpeers.hlf.kungfusoftware.es --all\n")),Object(c.b)("h2",{id:"deploying-an-ordering-service"},"Deploying an Ordering Service"),Object(c.b)("h3",{id:"deploying-a-certificate-authority-1"},"Deploying a certificate authority"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf ca create --storage-class=standard --capacity=2Gi --name=ord-ca \\\n    --enroll-id=enroll --enroll-pw=enrollpw\nkubectl wait --timeout=180s --for=condition=Running fabriccas.hlf.kungfusoftware.es --all\nkubectl hlf ca register --name=ord-ca --user=orderer --secret=ordererpw \\\n    --type=orderer --enroll-id enroll --enroll-secret=enrollpw --mspid=OrdererMSP\n\n")),Object(c.b)("h3",{id:"deploying-the-ordering-service"},"Deploying the Ordering service"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf ordservice create  --storage-class=standard --enroll-id=orderer --mspid=OrdererMSP \\\n    --enroll-pw=ordererpw --capacity=2Gi --name=ordservice --ca-name=ord-ca.default \\\n    --system-channel testchainid --num-orderers=1\nkubectl wait --timeout=180s --for=condition=Running fabricorderingservices.hlf.kungfusoftware.es --all\n")),Object(c.b)("h2",{id:"preparing-a-connection-string-for-the-ordering-service"},"Preparing a connection string for the ordering service"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf inspect --output ordservice.yaml -o OrdererMSP\nkubectl hlf ca register --name=ord-ca --user=admin --secret=adminpw \\\n    --type=admin --enroll-id enroll --enroll-secret=enrollpw --mspid=Ord2MSP\n\nkubectl hlf ca enroll --name=ord-ca --user=admin --secret=adminpw --mspid Ord2MSP \\\n        --ca-name ca  --output admin-ordservice.yaml \n## add user from admin-ordservice.yaml to ordservice.yaml\n\n")),Object(c.b)("h2",{id:"create-a-consortium"},"Create a consortium"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'kubectl hlf consortiums create --name=Default --system-channel-id="testchainid" \\\n    --config=ordservice.yaml --orderer-org=ordservice.default --user=admin \\\n    -p=org1-peer0.default\n')),Object(c.b)("h2",{id:"preparing-a-connection-string-for-the-peer"},"Preparing a connection string for the peer"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf ca register --name=org1-ca --user=admin --secret=adminpw --type=admin \\\n --enroll-id enroll --enroll-secret=enrollpw --mspid Org1MSP  \n\nkubectl hlf ca enroll --name=org1-ca --user=admin --secret=adminpw --mspid Org1MSP \\\n        --ca-name ca  --output peer-org1.yaml\n\nkubectl hlf inspect --output org1.yaml -o Org1MSP -o OrdererMSP\n\n## add user key and cert to org1.yaml from admin-ordservice.yaml\n")),Object(c.b)("h2",{id:"create-a-channel"},"Create a channel"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"\nkubectl hlf channel create --name=ch1 --config=org1.yaml \\\n    --admin-org=org1-peer0.default --user=admin \\\n    -p=org1-peer0.default --ordering-service=ordservice.default \\\n    --consortium=Default\n")),Object(c.b)("h2",{id:"add-anchor-peer"},"Add anchor peer"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf channel addanchorpeer --channel=ch1 --config=org1.yaml \\\n    --user=admin --peer=org1-peer0.default \n\n")),Object(c.b)("h2",{id:"join-channel"},"Join channel"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf channel join --name=ch1 --config=org1.yaml \\\n    --user=admin -p=org1-peer0.default\n\n")),Object(c.b)("h2",{id:"see-ledger-height"},"See ledger height"),Object(c.b)("p",null,"In case of error, you may need to add the following to the org1.yaml configuration file:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'channels:\n  _default:\n    peers:\n      "org1-peer0.default":\n          endorsingPeer: true\n          chaincodeQuery: true\n          ledgerQuery: true\n          eventSource: true\n')),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf channel top --channel=ch1 --config=org1.yaml \\\n    --user=admin -p=org1-peer0.default\n")),Object(c.b)("h2",{id:"install-a-chaincode"},"Install a chaincode"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf chaincode install --path=./fixtures/chaincodes/fabcar/go \\\n    --config=org1.yaml --language=golang --label=fabcar --user=admin --peer=org1-peer0.default\n\n# this can take 3-4 minutes\n")),Object(c.b)("h2",{id:"query-chaincodes-installed"},"Query chaincodes installed"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf chaincode queryinstalled --config=org1.yaml --user=admin --peer=org1-peer0.default\n")),Object(c.b)("h2",{id:"approve-chaincode"},"Approve chaincode"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'kubectl hlf chaincode approveformyorg --config=org1.yaml --user=admin --peer=org1-peer0.default \\\n    --package-id=fabcar:db8d009f7e2e9fa4a40ddfd6b7e603d3177b126d18cdbeabcf8481f9a6de519f \\\n    --version "1.0" --sequence 1 --name=fabcar \\\n    --policy="OR(\'Org1MSP.member\')" --channel=ch1\n')),Object(c.b)("h2",{id:"commit-chaincode"},"Commit chaincode"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'kubectl hlf chaincode commit --config=org1.yaml --user=admin --peer=org1-peer0.default \\\n    --version "1.0" --sequence 1 --name=fabcar \\\n    --policy="OR(\'Org1MSP.member\')" --channel=ch1\n')),Object(c.b)("h2",{id:"invoke-a-transaction-in-the-ledger"},"Invoke a transaction in the ledger"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf chaincode invoke --config=org1.yaml \\\n    --user=admin --peer=org1-peer0.default \\\n    --chaincode=fabcar --channel=ch1 \\\n    --fcn=initLedger -a '[]'\n")),Object(c.b)("h2",{id:"query-the-ledger"},"Query the ledger"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl hlf chaincode query --config=org1.yaml \\\n    --user=admin --peer=org1-peer0.default \\\n    --chaincode=fabcar --channel=ch1 \\\n    --fcn=QueryAllCars -a '[]'\n")),Object(c.b)("p",null,"At this point, you should have:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Ordering service with 3 nodes and a CA"),Object(c.b)("li",{parentName:"ul"},"Peer organization with a peer and a CA"),Object(c.b)("li",{parentName:"ul"},"A channel ",Object(c.b)("strong",{parentName:"li"},"ch1")),Object(c.b)("li",{parentName:"ul"},"A chaincode install in peer0"),Object(c.b)("li",{parentName:"ul"},"A chaincode approved and committed")),Object(c.b)("p",null,"If something went wrong or didn't work, please, open an issue."),Object(c.b)("h3",{id:"cleanup-the-environment"},"Cleanup the environment"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl delete fabricorderingservices.hlf.kungfusoftware.es --all-namespaces --all\nkubectl delete fabricpeers.hlf.kungfusoftware.es --all-namespaces --all\nkubectl delete fabriccas.hlf.kungfusoftware.es --all-namespaces --all\n")))}s.isMDXComponent=!0},86:function(e,n,r){"use strict";r.d(n,"a",(function(){return p})),r.d(n,"b",(function(){return g}));var a=r(0),t=r.n(a);function c(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function l(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?l(Object(r),!0).forEach((function(n){c(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e,n){if(null==e)return{};var r,a,t=function(e,n){if(null==e)return{};var r,a,t={},c=Object.keys(e);for(a=0;a<c.length;a++)r=c[a],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)r=c[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var d=t.a.createContext({}),s=function(e){var n=t.a.useContext(d),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},p=function(e){var n=s(e.components);return t.a.createElement(d.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.a.createElement(t.a.Fragment,{},n)}},b=t.a.forwardRef((function(e,n){var r=e.components,a=e.mdxType,c=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=s(r),b=a,g=p["".concat(l,".").concat(b)]||p[b]||u[b]||c;return r?t.a.createElement(g,i(i({ref:n},d),{},{components:r})):t.a.createElement(g,i({ref:n},d))}));function g(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var c=r.length,l=new Array(c);l[0]=b;var i={};for(var o in n)hasOwnProperty.call(n,o)&&(i[o]=n[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var d=2;d<c;d++)l[d]=r[d];return t.a.createElement.apply(null,l)}return t.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"}}]);